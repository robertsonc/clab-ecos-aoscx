!
! DFW-vCX-01 - Dallas AOS-CX Switch
! LAN: 10.1.0.0/16 block
!
hostname DFW-vCX-01
!
vrf CSN_Managed
    rd 198.18.1.1:10010
    route-target export 65001:10010 evpn
    route-target import 65001:10010 evpn
vrf CSN_Unmanaged
    rd 198.18.1.1:10011
    route-target export 65001:10011 evpn
    route-target import 65001:10011 evpn
vrf CSN_Guest
    rd 198.18.1.1:10012
    route-target export 65001:10012 evpn
    route-target import 65001:10012 evpn
!
vlan 1010
    name CSN_Managed
vlan 1011
    name CSN_Unmanaged
vlan 1012
    name CSN_Guest
!
interface loopback 0
    ip address 198.18.1.1/32
!
router ospf 1
   passive-interface default
   redistribute connected
   redistribute local loopback
   area 0.0.0.0
interface 1/1/1
    no shutdown
    description DFW-ECV-01 lan0
    ip address 10.1.0.1/30
    ip ospf 1 area 0.0.0.0
    no ip ospf passive
!
router bgp 65001
    bgp router-id 198.18.1.1
    neighbor 198.19.0.1 remote-as 64001
    neighbor 198.19.0.1 update-source loopback 0
    neighbor 198.19.0.1 ebgp-multihop 2
    address-family ipv4 unicast
        neighbor 198.19.0.1 activate
    exit-address-family
    address-family l2vpn evpn
        neighbor 198.19.0.1 send-community both
        neighbor 198.19.0.1 activate
    exit-address-family
!
    vrf CSN_Managed
        address-family ipv4 unicast
            redistribute connected
            redistribute local loopback
        exit-address-family
        address-family ipv6 unicast
            redistribute connected
        exit-address-family
!
    vrf CSN_Unmanaged
        address-family ipv4 unicast
            redistribute connected
            redistribute local loopback
        exit-address-family
        address-family ipv6 unicast
            redistribute connected
        exit-address-family
!
    vrf CSN_Guest
        address-family ipv4 unicast
            redistribute connected
            redistribute local loopback
        exit-address-family
        address-family ipv6 unicast
            redistribute connected
        exit-address-family
!
evpn
    arp-suppression
    vlan 1010
        rd auto
        route-target export auto
        route-target import auto
        redistribute host-route
    vlan 1011
        rd auto
        route-target export auto
        route-target import auto
        redistribute host-route
    vlan 1012
        rd auto
        route-target export auto
        route-target import auto
        redistribute host-route
!
interface vlan 1010
    vrf attach CSN_Managed
    ip mtu 9198
    ip address 192.168.10.1/24
interface vlan 1011
    vrf attach CSN_Unmanaged
    ip mtu 9198
    ip address 192.168.11.1/24
interface vlan 1012
    vrf attach CSN_Guest
    ip mtu 9198
    ip address 192.168.12.1/24
interface vxlan 1
    source ip 198.18.1.1
    no shutdown
    vni 1010
        vlan 1010
    vni 1011
        vlan 1011
    vni 1012
        vlan 1012
    vni 10010
        vrf CSN_Managed
        routing
    vni 10011
        vrf CSN_Unmanaged
        routing
    vni 10012
        vrf CSN_Guest
        routing
!
interface 1/1/2
    no shutdown
    description CSN_Managed client access
    no routing
    vlan access 1010
interface 1/1/3
    no shutdown
    description CSN_Unmanaged client access
    no routing
    vlan access 1011
interface 1/1/4
    no shutdown
    description CSN_Guest client access
    no routing
    vlan access 1012
!
dhcp-server vrf CSN_Managed
    pool CSN_Managed
        range 192.168.10.11 192.168.10.25
        default-router 192.168.10.1
        dns-server 8.8.8.8 8.8.4.4
        lease 00:12:00
        enable
        exit
    enable
    exit
dhcp-server vrf CSN_Unmanaged
    pool CSN_Unmanaged
        range 192.168.11.11 192.168.11.25
        default-router 192.168.11.1
        dns-server 8.8.8.8 8.8.4.4
        lease 00:12:00
        enable
        exit
    enable
    exit
dhcp-server vrf CSN_Guest
    pool CSN_Guest
        range 192.168.12.11 192.168.12.25
        default-router 192.168.12.1
        dns-server 8.8.8.8 8.8.4.4
        lease 00:12:00
        enable
        exit
    enable
    exit
!
